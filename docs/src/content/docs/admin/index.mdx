---
title: Administration Guide
description: Umfassende Administrationsdokumentation fÃ¼r Home4Strays
---

import { Tabs, TabItem } from '@astrojs/starlight/components';
import { Code } from '@astrojs/starlight/components';

# ğŸ  Home4Strays Administration Guide

Diese Dokumentation beschreibt die vollstÃ¤ndige Administration der Home4Strays-Anwendung mit Docker Compose und Caddy als Reverse Proxy.

## ğŸ“‹ Ãœberblick

Das Home4Strays-System besteht aus folgenden Komponenten:
- **ğŸ–¥ï¸ Frontend**: React/Next.js Anwendung
- **âš™ï¸ Backend**: API-Server
- **ğŸ—„ï¸ Datenbank**: PostgreSQL
- **ğŸ“¦ MinIO**: S3-kompatible Object Storage
- **ğŸš€ Caddy**: Reverse Proxy und Web Server
- **ğŸ”„ Watchtower**: Automatische Container-Updates
- **ğŸ“š Docs**: Starlight-basierte Dokumentation

## ğŸ“‹ Voraussetzungen

### ğŸ³ Docker Installation

Bevor Sie beginnen, mÃ¼ssen Docker und Docker Compose auf Ihrem System installiert werden.

:::note[ğŸ“– Offizielle Dokumentation]
FÃ¼r die neuesten und detailliertesten Installationsanweisungen besuchen Sie die [offizielle Docker-Dokumentation](https://docs.docker.com/engine/install/).
:::

<Tabs>
<TabItem label="ğŸ§ Ubuntu/Debian">

```bash
# Alte Docker-Versionen entfernen
sudo apt-get remove docker docker-engine docker.io containerd runc

# Repository hinzufÃ¼gen
sudo apt-get update
sudo apt-get install ca-certificates curl gnupg lsb-release

sudo mkdir -p /etc/apt/keyrings
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg

echo "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null

# Docker installieren
sudo apt-get update
sudo apt-get install docker-ce docker-ce-cli containerd.io docker-compose-plugin

# Benutzer zur Docker-Gruppe hinzufÃ¼gen
sudo usermod -aG docker $USER
```

ğŸ“– **Detaillierte Anleitung**: [Docker Installation auf Ubuntu](https://docs.docker.com/engine/install/ubuntu/)

</TabItem>
<TabItem label="ğŸ© CentOS/RHEL/Fedora">

```bash
sudo dnf remove docker docker-client docker-client-latest docker-common docker-latest docker-latest-logrotate docker-logrotate docker-engine

sudo dnf -y install dnf-plugins-core
sudo dnf config-manager --add-repo https://download.docker.com/linux/fedora/docker-ce.repo

sudo dnf install docker-ce docker-ce-cli containerd.io docker-compose-plugin
sudo systemctl start docker
sudo systemctl enable docker
sudo usermod -aG docker $USER
```

ğŸ“– **Detaillierte Anleitung**: [Docker Installation auf CentOS/RHEL/Fedora](https://docs.docker.com/engine/install/centos/)

</TabItem>
</Tabs>

:::note[âš ï¸ Wichtiger Hinweis]
Nach der Installation loggen Sie sich ab und wieder ein, damit die GruppenzugehÃ¶rigkeit wirksam wird.
:::

### ğŸ³ Docker Grundlagen

:::tip[ğŸ“– Weitere Informationen]
FÃ¼r eine umfassende EinfÃ¼hrung in Docker besuchen Sie die [Docker Grundlagen Dokumentation](https://docs.docker.com/get-started/).
:::

#### ğŸ”§ Wichtige Docker-Befehle

```bash
# Docker-Status prÃ¼fen
docker --version
docker compose version

# Container anzeigen
docker ps                    # Laufende Container
docker ps -a                 # Alle Container

# Images anzeigen
docker images

# Container-Logs anzeigen
docker logs <container-name>
docker logs -f <container-name>  # Follow-Modus

# Container stoppen/starten
docker stop <container-name>
docker start <container-name>
docker restart <container-name>

# Container entfernen
docker rm <container-name>
docker rmi <image-name>       # Image entfernen

# System aufrÃ¤umen
docker system prune -a        # Unbenutzte Container/Images entfernen
```

#### ğŸš€ Docker Compose Grundlagen

```bash
# Services starten
docker compose up -d          # Im Hintergrund starten

# Services stoppen
docker compose down           # Container stoppen und entfernen
docker compose stop           # Nur stoppen

# Services neu starten
docker compose restart

# Logs anzeigen
docker compose logs
docker compose logs -f <service-name>

# Konfiguration validieren
docker compose config
```

:::tip[ğŸ“– Docker Compose Dokumentation]
Mehr Ã¼ber Docker Compose erfahren Sie in der [offiziellen Docker Compose Dokumentation](https://docs.docker.com/compose/).
:::

## ğŸ“ Verzeichnisstruktur

Erstellen Sie folgende Verzeichnisstruktur auf Ihrem Server:

```
/opt/docker/
â”œâ”€â”€ compose/
â”‚   â”œâ”€â”€ docker-compose.yaml
â”‚   â”œâ”€â”€ .env
â”‚   â””â”€â”€ caddy/
â”‚       â”œâ”€â”€ docker-compose.yaml
â”‚       â”œâ”€â”€ Caddyfile
â”‚       â””â”€â”€ site/
â””â”€â”€ volumes/
    â”œâ”€â”€ home4strays/
    â”‚   â””â”€â”€ postgres/
    â”œâ”€â”€ minio/
    â”‚   â””â”€â”€ data/
    â”œâ”€â”€ test-minio/
    â”‚   â””â”€â”€ data/
    â””â”€â”€ caddy/
        â”œâ”€â”€ data/
        â””â”€â”€ config/
```

```bash
# ğŸ“ Verzeichnisse erstellen
sudo mkdir -p /opt/docker/{compose,volumes}/{home4strays/postgres,minio/data,test-minio/data,caddy/{data,config}}
sudo mkdir -p /opt/docker/compose/caddy/site
```

## ğŸ³ Konsolidierte Docker Compose Konfiguration

### ğŸ“„ Haupt-Docker-Compose-Datei

Erstellen Sie `/opt/docker/compose/docker-compose.yaml`:

```yaml
version: '3.8'

services:
  # ğŸ–¥ï¸ Frontend Services
  frontend:
    image: hub.informatik.hs-augsburg.de/home4strays/home4strays-frontend/image:main
    ports:
      - "127.0.0.1:3000:3000"
    networks:
      - caddy
    environment:
      - BACKEND_URL=https://api.example.org
    hostname: home4strays-frontend
    depends_on:
      - backend
    restart: unless-stopped

  # âš™ï¸ Backend Services
  backend:
    image: hub.informatik.hs-augsburg.de/home4strays/home4strays-backend/image:main
    ports:
      - "127.0.0.1:3100:3000"
    networks:
      caddy:
        aliases:
          - minio
      postgresql: {}
    hostname: home4strays-backend
    env_file: .env
    depends_on:
      - postgresql
      - minio
    restart: unless-stopped

  # ğŸ§ª Test Frontend (fÃ¼r Staging)
  test-frontend:
    image: hub.informatik.hs-augsburg.de/home4strays/home4strays-frontend/image:main
    ports:
      - "127.0.0.1:4000:3000"
    networks:
      - caddy
    hostname: test-home4strays-frontend
    environment:
      - BACKEND_URL=https://test-api.example.org
    restart: unless-stopped

  # ğŸ§ª Test Backend (fÃ¼r Staging)
  test-backend:
    image: hub.informatik.hs-augsburg.de/home4strays/home4strays-backend/image:main
    ports:
      - "127.0.0.1:4100:3000"
    networks:
      caddy:
        aliases:
          - test-minio
      postgresql: {}
    hostname: test-home4strays-backend
    env_file: .env
    depends_on:
      - postgresql
      - test-minio
    restart: unless-stopped

  # ğŸ—„ï¸ Datenbank
  postgresql:
    image: postgres:15
    ports:
      - "127.0.0.1:5432:5432"
    environment:
      - POSTGRES_USER=${DB_USER}
      - POSTGRES_DB=${DB_DATABASE}
      - POSTGRES_PASSWORD=${DB_PASSWORD}
    networks:
      - postgresql
    restart: unless-stopped
    volumes:
      - /opt/docker/volumes/home4strays/postgres:/var/lib/postgresql/data
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U ${DB_USER} -d ${DB_DATABASE}"]
      interval: 30s
      timeout: 10s
      retries: 3

  # ğŸ“¦ Production MinIO
  # Achtung wir verwenden hier einen alten Release, da Minio im neusten Release das meiste im Web-Interface entfernt hat.
  # Schau auch gerne hier: https://github.com/OpenMaxIO/openmaxio-object-browser
  minio:
    image: minio/minio:RELEASE.2025-04-22T22-12-26Z
    container_name: minio
    hostname: minio
    ports:
      - "127.0.0.1:9000:9000"
      - "127.0.0.1:9001:9001"
    environment:
      MINIO_ROOT_USER: ${MINIO_ROOT_USER}
      MINIO_ROOT_PASSWORD: ${MINIO_ROOT_PASSWORD}
    volumes:
      - /opt/docker/volumes/minio/data:/data
    command: server /data --console-address ":9001"
    networks:
      - caddy
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9000/minio/health/live"]
      interval: 30s
      timeout: 20s
      retries: 3

  # ğŸ§ª Test MinIO (fÃ¼r Staging)
  test-minio:
    image: minio/minio:RELEASE.2025-04-22T22-12-26Z
    container_name: test-minio
    hostname: test-minio
    ports:
      - "127.0.0.1:9100:9000"
      - "127.0.0.1:9101:9001"
    environment:
      MINIO_ROOT_USER: ${TEST_MINIO_ROOT_USER}
      MINIO_ROOT_PASSWORD: ${TEST_MINIO_ROOT_PASSWORD}
    volumes:
      - /opt/docker/volumes/test-minio/data:/data
    command: server /data --console-address ":9001"
    networks:
      - caddy
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9000/minio/health/live"]
      interval: 30s
      timeout: 20s
      retries: 3

  # ğŸ“š Dokumentation
  docs:
    image: hub.informatik.hs-augsburg.de/home4strays/docs/image:main
    ports:
      - "127.0.0.1:8080:80"
    environment:
      - BASE_URL=https://example.org/docs
    networks:
      - caddy
    hostname: docs
    restart: unless-stopped

  # ğŸ§ª Test Dokumentation
  test-docs:
    image: hub.informatik.hs-augsburg.de/home4strays/docs/image:main
    ports:
      - "127.0.0.1:8081:80"
    environment:
      - BASE_URL=https://test.example.org/docs
    networks:
      - caddy
    hostname: test-docs
    restart: unless-stopped

  # ğŸ”„ Automatische Updates
  watchtower:
    image: containrrr/watchtower
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - /root/.docker/config.json:/config.json:ro
    environment:
      - WATCHTOWER_POLL_INTERVAL=300
      - WATCHTOWER_CLEANUP=true
      - WATCHTOWER_INCLUDE_RESTARTING=true
    restart: unless-stopped

networks:
  caddy:
    name: caddy
    external: true
  postgresql:
    name: postgresql
    driver: bridge
```

:::tip[ğŸ“– Service-Dokumentationen]
- **PostgreSQL**: [Offizielle PostgreSQL Docker Dokumentation](https://hub.docker.com/_/postgres)
- **MinIO**: [MinIO Docker Dokumentation](https://min.io/docs/minio/container/index.html)
- **Watchtower**: [Watchtower Dokumentation](https://containrrr.dev/watchtower/)
:::

### ğŸ”§ Umgebungsvariablen (.env)

Erstellen Sie `/opt/docker/compose/.env`:

```bash
# ğŸ—„ï¸ Datenbank-Konfiguration
DB_USER=home4strays
DB_DATABASE=home4strays
DB_PASSWORD=your_secure_db_password_here

# ğŸ“¦ Production MinIO
MINIO_ROOT_USER=admin
MINIO_ROOT_PASSWORD=your_very_secure_minio_password_here_min_32_chars

# ğŸ§ª Test MinIO
TEST_MINIO_ROOT_USER=testadmin
TEST_MINIO_ROOT_PASSWORD=your_test_minio_password_here_min_32_chars

# âš™ï¸ Backend-Konfiguration (weitere Variablen nach Bedarf)
NODE_ENV=production
JWT_SECRET=your_jwt_secret_here
```

:::caution[ğŸ”’ Sicherheit]
- Verwenden Sie starke, einzigartige PasswÃ¶rter
- MinIO-PasswÃ¶rter mÃ¼ssen mindestens 8 Zeichen lang sein
- Stellen Sie sicher, dass die `.env`-Datei nicht Ã¶ffentlich zugÃ¤nglich ist
:::

## ğŸš€ Caddy-Konfiguration

:::tip[ğŸ“– Caddy Dokumentation]
FÃ¼r detaillierte Informationen zur Caddy-Konfiguration besuchen Sie die [offizielle Caddy Dokumentation](https://caddyserver.com/docs/).
:::

### ğŸ³ Caddy Docker Compose

Erstellen Sie `/opt/docker/compose/caddy/docker-compose.yaml`:

```yaml
version: '3.8'

services:
  # ğŸš€ Caddy Reverse Proxy
  caddy:
    image: caddy:2-alpine
    restart: unless-stopped
    hostname: caddy
    networks:
      - caddy
    ports:
      - "80:80"
      - "443:443"
      - "443:443/udp"  # HTTP/3 Support
    volumes:
      - ./Caddyfile:/etc/caddy/Caddyfile:ro
      - ./site:/srv:ro
      - /opt/docker/volumes/caddy/data:/data
      - /opt/docker/volumes/caddy/config:/config
    environment:
      - CADDY_ADMIN=0.0.0.0:2019
    healthcheck:
      test: ["CMD", "caddy", "version"]
      interval: 30s
      timeout: 10s
      retries: 3

networks:
  caddy:
    name: caddy
    external: true
```

### ğŸ“‹ Beispiel-Caddyfile

Erstellen Sie `/opt/docker/compose/caddy/Caddyfile`:

```caddyfile
# ğŸŒ Production Domain
example.org {
    # ğŸ”’ TLS-Konfiguration mit Let's Encrypt
    tls admin@example.org

    # ğŸ›¡ï¸ Security Headers
    header {
        Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
        X-Content-Type-Options "nosniff"
        X-Frame-Options "DENY"
        X-XSS-Protection "1; mode=block"
        Referrer-Policy "strict-origin-when-cross-origin"
        Permissions-Policy "geolocation=(), microphone=(), camera=()"
    }

    # ğŸ“š Dokumentation
    handle_path /docs* {
        reverse_proxy docs:80 {
            header_up Host {upstream_hostport}
            header_up X-Real-IP {remote_host}
            header_up X-Forwarded-For {remote_host}
            header_up X-Forwarded-Proto {scheme}
        }
    }

    # ğŸ  Hauptanwendung
    handle_path /* {
        reverse_proxy home4strays-frontend:3000 {
            header_up Host {upstream_hostport}
            header_up X-Real-IP {remote_host}
            header_up X-Forwarded-For {remote_host}
            header_up X-Forwarded-Proto {scheme}
        }
    }

    # ğŸ“ Logging
    log {
        output file /data/logs/example.org.log {
            roll_size 10MiB
            roll_keep 10
        }
        format json
    }
}

# ğŸ”Œ API Domain
api.example.org {
    tls admin@example.org

    # ğŸ›¡ï¸ Security Headers fÃ¼r API
    header {
        Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
        X-Content-Type-Options "nosniff"
        Access-Control-Allow-Origin "*"
        Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
        Access-Control-Allow-Headers "Content-Type, Authorization"
    }

    # ğŸ”„ API Reverse Proxy
    reverse_proxy home4strays-backend:3000 {
        header_up Host {upstream_hostport}
        header_up X-Real-IP {remote_host}
        header_up X-Forwarded-For {remote_host}
        header_up X-Forwarded-Proto {scheme}
    }

    # ğŸ“ Logging
    log {
        output file /data/logs/api.example.org.log {
            roll_size 10MiB
            roll_keep 10
        }
        format json
    }
}

# ğŸ“¦ S3 Storage Domain
s3.example.org {
    tls admin@example.org

    # ğŸ—„ï¸ MinIO S3 API
    reverse_proxy minio:9000 {
        header_up Host {upstream_hostport}
        header_up X-Real-IP {remote_host}
        header_up X-Forwarded-For {remote_host}
        header_up X-Forwarded-Proto {scheme}
    }

    # ğŸ“ Logging
    log {
        output file /data/logs/s3.example.org.log {
            roll_size 10MiB
            roll_keep 10
        }
        format json
    }
}

# ğŸ›ï¸ S3 Admin Console
s3-admin.example.org {
    tls admin@example.org

    # ğŸ›¡ï¸ Security Headers
    header {
        Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
        X-Content-Type-Options "nosniff"
        X-Frame-Options "SAMEORIGIN"
    }

    # ğŸ—„ï¸ MinIO Admin Console
    reverse_proxy minio:9001 {
        header_up Host {upstream_hostport}
        header_up X-Real-IP {remote_host}
        header_up X-Forwarded-For {remote_host}
        header_up X-Forwarded-Proto {scheme}
    }

    # ğŸ“ Logging
    log {
        output file /data/logs/s3-admin.example.org.log {
            roll_size 10MiB
            roll_keep 10
        }
        format json
    }
}

# ğŸ§ª Test/Staging Domain
test.example.org {
    tls admin@example.org

    # ğŸ”Œ API-Endpunkte fÃ¼r Tests
    handle_path /api/openapi* {
        rewrite * /openapi{path}
        reverse_proxy test-home4strays-backend:3000
    }

    handle_path /openapi* {
        rewrite * /openapi{path}
        reverse_proxy test-home4strays-backend:3000
    }

    handle_path /api* {
        reverse_proxy test-home4strays-backend:3000
    }

    # ğŸ§ª Test S3
    handle_path /s3* {
        reverse_proxy test-minio:9000
    }

    # ğŸ§ª Test MinIO Admin
    handle_path /minio-admin* {
        reverse_proxy test-minio:9001
    }

    # ğŸ§ª Test Dokumentation
    handle_path /docs* {
        reverse_proxy test-docs:80
    }

    # ğŸ§ª Test Frontend
    handle_path /* {
        reverse_proxy test-home4strays-frontend:3000
    }

    # ğŸ“ Logging
    log {
        output file /data/logs/test.example.org.log {
            roll_size 10MiB
            roll_keep 10
        }
        format json
    }
}

# ğŸ›ï¸ Admin Interface (optional, nur fÃ¼r interne Nutzung)
admin.example.org {
    tls admin@example.org

    # ğŸ” Basis-Authentifizierung
    basicauth {
        admin $2a$14$hashed_password_here
    }

    # ğŸ›ï¸ Caddy Admin API
    reverse_proxy localhost:2019
}
```

:::tip[ğŸ“– Caddyfile Syntax]
Weitere Informationen zur Caddyfile-Syntax finden Sie in der [Caddyfile Dokumentation](https://caddyserver.com/docs/caddyfile).
:::

## ğŸš€ Deployment und Verwaltung

### ğŸ¯ Erstmalige Einrichtung

1. **ğŸŒ Netzwerk erstellen:**
```bash
cd /opt/docker/compose
docker network create caddy
```

2. **ğŸ”§ Umgebungsvariablen konfigurieren:**
```bash
# .env-Datei erstellen und bearbeiten
cp .env.example .env
nano .env
```

3. **ğŸ” Berechtigungen setzen:**
```bash
sudo chown -R $USER:docker /opt/docker/
sudo chmod -R 755 /opt/docker/compose/
sudo chmod 600 /opt/docker/compose/.env
```

4. **â–¶ï¸ Services starten:**
```bash
# Hauptanwendung starten
docker compose up -d

# Caddy starten
cd caddy/
docker compose up -d
```

### ğŸ”§ RegelmÃ¤ÃŸige Wartung

#### ğŸ“¦ System-Updates

```bash
# System-Pakete aktualisieren
sudo apt update && sudo apt upgrade -y

# Docker-Images aktualisieren (wird automatisch durch Watchtower gemacht)
docker compose pull
docker compose up -d
```

#### ğŸ’¾ Backup-Strategien

<Tabs>
<TabItem label="ğŸ—„ï¸ Datenbank-Backup">

```bash
#!/bin/bash
# backup-db.sh

BACKUP_DIR="/opt/backups/postgres"
DATE=$(date +%Y%m%d_%H%M%S)
DB_CONTAINER="compose_postgresql_1"

mkdir -p $BACKUP_DIR

# ğŸ’¾ Datenbank-Backup erstellen
docker exec $DB_CONTAINER pg_dump -U home4strays home4strays > $BACKUP_DIR/home4strays_$DATE.sql

# ğŸ—‘ï¸ Alte Backups lÃ¶schen (Ã¤lter als 30 Tage)
find $BACKUP_DIR -name "*.sql" -mtime +30 -delete

echo "âœ… Backup erstellt: $BACKUP_DIR/home4strays_$DATE.sql"
```

:::tip[ğŸ“– PostgreSQL Backup-Dokumentation]
Weitere Informationen zu PostgreSQL-Backups finden Sie in der [PostgreSQL Backup-Dokumentation](https://www.postgresql.org/docs/current/backup.html).
:::

</TabItem>
<TabItem label="ğŸ“¦ MinIO-Backup">

```bash
#!/bin/bash
# backup-minio.sh

BACKUP_DIR="/opt/backups/minio"
DATE=$(date +%Y%m%d_%H%M%S)
MINIO_DATA="/opt/docker/volumes/minio/data"

mkdir -p $BACKUP_DIR

# ğŸ”„ MinIO-Daten synchronisieren
rsync -av --delete $MINIO_DATA/ $BACKUP_DIR/minio_$DATE/

# ğŸ—‘ï¸ Alte Backups lÃ¶schen (Ã¤lter als 7 Tage)
find $BACKUP_DIR -maxdepth 1 -type d -name "minio_*" -mtime +7 -exec rm -rf {} \;

echo "âœ… MinIO Backup erstellt: $BACKUP_DIR/minio_$DATE/"
```

:::tip[ğŸ“– MinIO Backup-Dokumentation]
Weitere Informationen zu MinIO-Backups finden Sie in der [MinIO Backup-Dokumentation](https://min.io/docs/minio/linux/operations/backup-restore.html).
:::

</TabItem>
</Tabs>

#### â° Cronjob fÃ¼r automatische Backups

```bash
# Cronjob hinzufÃ¼gen
crontab -e

# ğŸŒ™ TÃ¤glich um 2:00 Uhr Datenbank-Backup
0 2 * * * /opt/docker/scripts/backup-db.sh

# ğŸŒ™ TÃ¤glich um 3:00 Uhr MinIO-Backup
0 3 * * * /opt/docker/scripts/backup-minio.sh
```

### ğŸ“Š Monitoring und Logs

#### ğŸ“ Log-Verwaltung

```bash
# ğŸ“‹ Alle Service-Logs anzeigen
docker compose logs

# ğŸ¯ Spezifische Service-Logs
docker compose logs frontend
docker compose logs backend
docker compose logs postgresql

# ğŸ”„ Live-Logs verfolgen
docker compose logs -f

# ğŸš€ Caddy-Logs
docker compose -f caddy/docker-compose.yaml logs caddy

# ğŸ³ Systemweite Container-Logs
docker logs <container-name>
```

#### ğŸ“ˆ SystemÃ¼berwachung

```bash
# ğŸ“Š Container-Status
docker compose ps

# ğŸ’» Ressourcenverbrauch
docker stats

# ğŸ’½ Festplattenspeicher
df -h /opt/docker/volumes/

# ğŸŒ Netzwerk-Status
docker network ls
docker network inspect caddy
```

### ğŸ”§ Troubleshooting

#### âš ï¸ HÃ¤ufige Probleme

**âŒ Problem: Services starten nicht**
```bash
# âœ… Konfiguration validieren
docker compose config

# ğŸ” Detaillierte Fehlermeldungen
docker compose up --no-deps service-name

# ğŸ“Š Container-Status prÃ¼fen
docker compose ps -a
```

**âŒ Problem: Datenbankverbindung fehlgeschlagen**
```bash
# ğŸ“ PostgreSQL-Container-Logs prÃ¼fen
docker compose logs postgresql

# ğŸ”Œ Datenbankverbindung testen
docker compose exec postgresql psql -U home4strays -d home4strays -c "SELECT version();"
```

**âŒ Problem: MinIO nicht erreichbar**
```bash
# ğŸ“ MinIO-Status prÃ¼fen
docker compose logs minio

# â¤ï¸ Health-Check
docker compose exec minio curl http://localhost:9000/minio/health/live
```

**âŒ Problem: Caddy-Zertifikate**
```bash
# ğŸ“ Caddy-Logs prÃ¼fen
docker compose -f caddy/docker-compose.yaml logs caddy

# ğŸ”’ Zertifikat-Status
docker compose -f caddy/docker-compose.yaml exec caddy caddy list-certificates
```

#### ğŸš¨ Notfall-Wiederherstellung

1. **â¹ï¸ Service stoppen:**
```bash
docker compose down
```

2. **ğŸ—„ï¸ Datenbank wiederherstellen:**
```bash
# Container temporÃ¤r starten
docker compose up -d postgresql

# Backup einspielen
cat /opt/backups/postgres/home4strays_YYYYMMDD_HHMMSS.sql | docker compose exec -T postgresql psql -U home4strays -d home4strays
```

3. **ğŸ“¦ MinIO-Daten wiederherstellen:**
```bash
# Daten zurÃ¼ckkopieren
rsync -av /opt/backups/minio/minio_YYYYMMDD_HHMMSS/ /opt/docker/volumes/minio/data/
```

4. **â–¶ï¸ Services neu starten:**
```bash
docker compose up -d
```

## ğŸ”’ SicherheitsÃ¼berlegungen

### ğŸ›¡ï¸ Firewall-Konfiguration

```bash
# ğŸ” UFW (Ubuntu Firewall) konfigurieren
sudo ufw enable
sudo ufw default deny incoming
sudo ufw default allow outgoing

# ğŸšª Nur notwendige Ports Ã¶ffnen
sudo ufw allow 22/tcp    # SSH
sudo ufw allow 80/tcp    # HTTP
sudo ufw allow 443/tcp   # HTTPS

# ğŸ  Lokale Dienste nur von localhost erreichbar machen
# (Docker bindet bereits an 127.0.0.1)
```

### ğŸ”’ SSL/TLS-Konfiguration

Das Caddyfile verwendet automatisch Let's Encrypt fÃ¼r SSL-Zertifikate. FÃ¼r zusÃ¤tzliche Sicherheit:

- Verwenden Sie starke TLS-Cipher-Suites
- Aktivieren Sie HSTS (bereits im Beispiel enthalten)
- ÃœberprÃ¼fen Sie regelmÃ¤ÃŸig die SSL-Konfiguration mit Tools wie SSL Labs

:::tip[ğŸ“– Let's Encrypt Dokumentation]
Weitere Informationen zu Let's Encrypt und SSL-Zertifikaten finden Sie in der [Let's Encrypt Dokumentation](https://letsencrypt.org/docs/).
:::

### ğŸ”„ RegelmÃ¤ÃŸige Sicherheitsupdates

```bash
# ğŸ” Automatische Sicherheitsupdates aktivieren
sudo apt install unattended-upgrades
sudo dpkg-reconfigure unattended-upgrades

# ğŸ”„ Docker-Images durch Watchtower automatisch aktualisieren (bereits konfiguriert)
```

:::tip[ğŸ“– Watchtower Dokumentation]
Weitere Informationen zur Watchtower-Konfiguration finden Sie in der [Watchtower Dokumentation](https://containrrr.dev/watchtower/).
:::

## âš¡ Performance-Optimierung

### ğŸ“Š Container-Ressourcen begrenzen

Erweitern Sie die Docker Compose-Konfiguration um Ressourcenlimits:

```yaml
services:
  backend:
    # ... andere Konfiguration
    deploy:
      resources:
        limits:
          memory: 1G
          cpus: '0.5'
        reservations:
          memory: 512M
          cpus: '0.25'
```

:::tip[ğŸ“– Docker Resource Management]
Mehr Ã¼ber Docker-Ressourcenverwaltung erfahren Sie in der [Docker Resource Constraints Dokumentation](https://docs.docker.com/config/containers/resource_constraints/).
:::

### ğŸ—„ï¸ Datenbank-Optimierung

Erstellen Sie eine PostgreSQL-Konfigurationsdatei fÃ¼r bessere Performance:

```bash
# /opt/docker/compose/postgresql.conf
shared_buffers = 256MB
effective_cache_size = 1GB
maintenance_work_mem = 64MB
checkpoint_completion_target = 0.9
wal_buffers = 16MB
default_statistics_target = 100
random_page_cost = 1.1
effective_io_concurrency = 200
```

FÃ¼gen Sie dann das Volume zur PostgreSQL-Konfiguration hinzu:

```yaml
postgresql:
  # ... andere Konfiguration
  volumes:
    - /opt/docker/volumes/home4strays/postgres:/var/lib/postgresql/data
    - ./postgresql.conf:/etc/postgresql/postgresql.conf:ro
  command: postgres -c config_file=/etc/postgresql/postgresql.conf
```

:::tip[ğŸ“– PostgreSQL Performance Tuning]
Weitere Informationen zur PostgreSQL-Performance-Optimierung finden Sie in der [PostgreSQL Performance Tuning Dokumentation](https://www.postgresql.org/docs/current/runtime-config.html).
:::

## ğŸ“± Erweiterte Konfigurationen

### ğŸ“Š Monitoring mit Portainer (Optional)

FÃ¼r eine grafische BenutzeroberflÃ¤che zur Container-Verwaltung kÃ¶nnen Sie Portainer hinzufÃ¼gen:

```yaml
# Zu docker-compose.yaml hinzufÃ¼gen
  # ğŸ“Š Portainer fÃ¼r Container-Management
  portainer:
    image: portainer/portainer-ce:latest
    ports:
      - "127.0.0.1:9443:9443"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - portainer_data:/data
    restart: unless-stopped
    command: -H unix:///var/run/docker.sock

volumes:
  portainer_data:
```

:::tip[ğŸ“– Portainer Dokumentation]
Weitere Informationen zu Portainer finden Sie in der [Portainer Dokumentation](https://docs.portainer.io/).
:::

### ğŸ“ Logging mit ELK Stack (Optional)

FÃ¼r erweiterte Log-Analyse kÃ¶nnen Sie einen ELK Stack (Elasticsearch, Logstash, Kibana) hinzufÃ¼gen:

```yaml
# Erweiterte Logging-Konfiguration
  # ğŸ” Elasticsearch
  elasticsearch:
    image: docker.elastic.co/elasticsearch/elasticsearch:8.11.0
    environment:
      - discovery.type=single-node
      - xpack.security.enabled=false
    ports:
      - "127.0.0.1:9200:9200"
    volumes:
      - elasticsearch_data:/usr/share/elasticsearch/data
    networks:
      - elk

  # ğŸ“Š Kibana
  kibana:
    image: docker.elastic.co/kibana/kibana:8.11.0
    ports:
      - "127.0.0.1:5601:5601"
    environment:
      - ELASTICSEARCH_HOSTS=http://elasticsearch:9200
    depends_on:
      - elasticsearch
    networks:
      - elk

volumes:
  elasticsearch_data:

networks:
  elk:
    driver: bridge
```

:::tip[ğŸ“– Elastic Stack Dokumentation]
Weitere Informationen zum Elastic Stack finden Sie in der [Elastic Stack Dokumentation](https://www.elastic.co/guide/index.html).
:::

## ğŸ”„ CI/CD Integration

### ğŸš€ GitLab CI Integration

Beispiel `.gitlab-ci.yml` fÃ¼r automatische Deployments:

```yaml
stages:
  - deploy

deploy_production:
  stage: deploy
  script:
    - ssh user@server 'cd /opt/docker/compose && docker compose pull && docker compose up -d'
  only:
    - main
  when: manual

deploy_staging:
  stage: deploy
  script:
    - ssh user@server 'cd /opt/docker/compose && docker compose pull test-frontend test-backend test-docs && docker compose up -d'
  only:
    - develop
  when: manual
```

### ğŸ”§ Wartungsskripte

Erstellen Sie nÃ¼tzliche Wartungsskripte:

```bash
#!/bin/bash
# /opt/docker/scripts/maintenance.sh

echo "ğŸ”§ Starte Wartungsroutine..."

# ğŸ—‘ï¸ Unbenutzte Docker-Ressourcen aufrÃ¤umen
echo "ğŸ§¹ RÃ¤ume Docker-System auf..."
docker system prune -af

# ğŸ“Š Speicherplatz prÃ¼fen
echo "ğŸ’½ Aktueller Speicherplatz:"
df -h /opt/docker/volumes/

# ğŸ“ Log-GrÃ¶ÃŸen prÃ¼fen
echo "ğŸ“ Log-GrÃ¶ÃŸen:"
du -sh /opt/docker/volumes/caddy/data/logs/

# â¤ï¸ Health-Checks durchfÃ¼hren
echo "â¤ï¸ FÃ¼hre Health-Checks durch..."
docker compose ps
docker compose exec postgresql pg_isready -U home4strays -d home4strays
docker compose exec minio curl -f http://localhost:9000/minio/health/live

echo "âœ… Wartung abgeschlossen!"
```

## ğŸ“š Weitere Ressourcen

### ğŸ“– Offizielle Dokumentationen

- **ğŸ³ Docker**: [https://docs.docker.com/](https://docs.docker.com/)
- **ğŸš€ Caddy**: [https://caddyserver.com/docs/](https://caddyserver.com/docs/)
- **ğŸ—„ï¸ PostgreSQL**: [https://www.postgresql.org/docs/](https://www.postgresql.org/docs/)
- **ğŸ“¦ MinIO**: [https://min.io/docs/](https://min.io/docs/)
- **ğŸ”„ Watchtower**: [https://containrrr.dev/watchtower/](https://containrrr.dev/watchtower/)

### ğŸ†” Best Practices

- **ğŸ”’ Sicherheit**: Verwenden Sie immer starke PasswÃ¶rter und halten Sie Ihre Container aktuell
- **ğŸ’¾ Backups**: Erstellen Sie regelmÃ¤ÃŸige Backups und testen Sie die Wiederherstellung
- **ğŸ“Š Monitoring**: Ãœberwachen Sie Ihre Container und Ressourcenverbrauch
- **ğŸ“ Dokumentation**: Halten Sie Ihre Konfiguration und Ã„nderungen dokumentiert
- **ğŸ§ª Testing**: Testen Sie Ã„nderungen zunÃ¤chst in der Staging-Umgebung

### ğŸš¨ Support und Hilfe

Bei Problemen oder Fragen:

1. **ğŸ“ Logs prÃ¼fen**: Schauen Sie zuerst in die Container-Logs
2. **ğŸ“– Dokumentation**: Konsultieren Sie die offiziellen Dokumentationen
3. **ğŸ” Community**: Nutzen Sie Community-Foren wie Stack Overflow oder Reddit
4. **ğŸ› Issues**: Melden Sie Bugs in den entsprechenden GitHub-Repositories

---

## ğŸ“‹ Checkliste fÃ¼r Produktivumgebung

### âœ… Pre-Deployment Checklist

- [ ] ğŸ” Starke PasswÃ¶rter in `.env` gesetzt
- [ ] ğŸ›¡ï¸ Firewall konfiguriert
- [ ] ğŸ”’ SSL-Zertifikate funktionieren
- [ ] ğŸ’¾ Backup-Strategie implementiert
- [ ] ğŸ“Š Monitoring eingerichtet
- [ ] ğŸ§ª Testing in Staging-Umgebung erfolgreich
- [ ] ğŸ“ Dokumentation aktualisiert
- [ ] ğŸš¨ Notfall-Wiederherstellungsplan getestet

### âœ… Post-Deployment Checklist

- [ ] ğŸŒ Alle Services erreichbar
- [ ] â¤ï¸ Health-Checks erfolgreich
- [ ] ğŸ“ Logs werden korrekt geschrieben
- [ ] ğŸ”„ Watchtower funktioniert
- [ ] ğŸ’¾ Backups werden erstellt
- [ ] ğŸ“Š Performance-Metriken normal
- [ ] ğŸ”’ Sicherheits-Scans durchgefÃ¼hrt

---

